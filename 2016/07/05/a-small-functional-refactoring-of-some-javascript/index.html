
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A Small Functional Refactoring of Javascript - Hamish Rickerby</title>
  <meta name="author" content="Hamish Rickerby">

  
  <meta name="description" content="I&rsquo;m working on a web based productivity application at the moment, and have been modifying some old code. This code deals with synchronisation &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://hamishrickerby.com/2016/07/05/a-small-functional-refactoring-of-some-javascript">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Hamish Rickerby" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<script type="text/javascript">
    var host = "hamishrickerby.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
</script>
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="/javascripts/footnote.js" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-535090-7']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Hamish Rickerby</a></h1>
  
    <h2>Technology Consultant & iOS Developer based in Sydney, Australia</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hamishrickerby.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/books">Reading List</a></li>
  <li><a href="http://twitter.com/rickerbh">Twitter</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Small Functional Refactoring of Javascript</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-05T16:26:31+10:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:26 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="https://hamishrickerby.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;m working on a web based productivity application at the moment, and have been modifying some old code. This code deals with synchronisation of data with external services, and storage of metadata about the synchronisation of that data. The application had quite a bit of duplication in dealing with this metadata; specifically in extracting data from the stored structures. In the interests of having very DRY Javascript, it was time to refactor.</p>

<p>The configuration/metadata structures typically look like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  ...
</span><span class='line'>  config: [{ key: 'attribute-name', value: { value: 'attribute-value' }}],
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><em>Sidenote: value is embedded in value because the top-level value item actually receives an object to store, so other fields can be added in the future</em></p>

<p>The metadata object was then optionally attached to other user-entered data entities, and queried when updates that require synchronisation to be triggered.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>const containerObject = {...
</span><span class='line'>  config: [
</span><span class='line'>      { key: 'itemId', value: { value: 12345 }}, 
</span><span class='line'>      { key: 'itemState', value: { value: 'active' }}
</span><span class='line'>    ],
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p>The application was already using <a href="http://ramdajs.com/">RamdaJS</a> to extract data from these types of structures.  To query, there was a whole bunch of duplicated code that traversed the containing objects, and extracted data. Example below.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Extract config object, maybe.
</span><span class='line'>const syncData = R.propOr({}, 'config')(containerObject);
</span><span class='line'>// Find a structure with a specific key value
</span><span class='line'>const itemSyncData = R.find(R.propEq('key', 'itemId'), syncData) || {};
</span><span class='line'>// Extract the value from the entity with that key
</span><span class='line'>const itemId = R.path(['value', 'value'], itemSyncData);</span></code></pre></td></tr></table></div></figure>


<p>To DRY all this up, I looked at the possibility of using <a href="https://en.wikipedia.org/wiki/Currying">Currying</a> and <a href="https://en.wikipedia.org/wiki/Partial_application">Partial Application</a> to help me define generic extraction functions, and reuse them.</p>

<p>First of all, I turned the above into a composed function, with the results of one step flowing as the inputs to the next.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// compose reads from the bottom up, like you're feeding in the object from
</span><span class='line'>// the end and it's consuming it, right to left.
</span><span class='line'>const composedFunction = R.compose(
</span><span class='line'>  R.path(['value', 'value'],
</span><span class='line'>  R.find(R.propEq('key', 'itemId')),
</span><span class='line'>  R.propOr({}, 'config')
</span><span class='line'>); 
</span><span class='line'>
</span><span class='line'>// How to use?
</span><span class='line'>const itemId = composedFunction(containerObject);</span></code></pre></td></tr></table></div></figure>


<p>However, this only supports <code>config</code> objects in the container, and <code>itemId</code>&rsquo;s inside that. We can make this more generic.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>const composedGenericFunction = (data, key) =&gt; R.compose(
</span><span class='line'>  R.path(['value', 'value'],
</span><span class='line'>  R.find(R.propEq('key', key)),
</span><span class='line'>  R.propOr({}, data)
</span><span class='line'>); 
</span><span class='line'>
</span><span class='line'>// How to use?
</span><span class='line'>const itemId = composedGenericFunction('config', 'itemId')(containerObject);
</span><span class='line'>const itemState = composedGenericFunction('config', 'itemState')(containerObject);</span></code></pre></td></tr></table></div></figure>


<p>Better because we get more reuse, but we still are repeating ourselves with the definition of the attribute that houses the config. So, lets make our function even more reusable with currying and partial application.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>const composedGenericCurriedFunction = R.curry((data, key) =&gt; R.compose(
</span><span class='line'>  R.path(['value', 'value'],
</span><span class='line'>  R.find(R.propEq('key', key)),
</span><span class='line'>  R.propOr({}, data)
</span><span class='line'>)); 
</span><span class='line'>
</span><span class='line'>// How to use?
</span><span class='line'>const configGetter = composedGenericCurriedFunction('config'); // Partial Application
</span><span class='line'>const itemId = configGetter('itemId')(containerObject);
</span><span class='line'>const itemState = configGetter('itemState')(containerObject);</span></code></pre></td></tr></table></div></figure>


<p>We can take this a step further with something like below, and generate a getter that will retrieve the itemId from different containerObjects.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>const idGetter = configGetter('itemId');
</span><span class='line'>const idOne = idGetter(containerObject);
</span><span class='line'>const idTwo = idGetter(containerObjectTwo);</span></code></pre></td></tr></table></div></figure>


<p>We can also extract fields from other objects that conform to the same structure, but aren&rsquo;t under a <code>config</code> key.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>const syncDataGetter = composedGenericCurriedFunction('syncData');</span></code></pre></td></tr></table></div></figure>


<p>So, with the use of currying and partial application with Ramda, we can create generic, reusable functions that are then used to generate other functions that we can use in our application. Super easy and effective way to DRY out your javascript.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Hamish Rickerby</span></span>

      




<time class='entry-date' datetime='2016-07-05T16:26:31+10:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:26 pm</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://hamishrickerby.com/2016/07/05/a-small-functional-refactoring-of-some-javascript/" data-via="rickerbh" data-counturl="https://hamishrickerby.com/2016/07/05/a-small-functional-refactoring-of-some-javascript/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2016/06/29/meteor-heroku-and-bcrypt/" title="Previous Post: Meteor, Heroku, and bcrypt">&laquo; Meteor, Heroku, and bcrypt</a>
      
      
        <a class="basic-alignment right" href="/2016/07/20/function-arguments/" title="Next Post: Function Arguments">Function Arguments &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2016/07/20/function-arguments/">Function Arguments</a>
      </li>
    
      <li class="post">
        <a href="/2016/07/05/a-small-functional-refactoring-of-some-javascript/">A Small Functional Refactoring of Javascript</a>
      </li>
    
      <li class="post">
        <a href="/2016/06/29/meteor-heroku-and-bcrypt/">Meteor, Heroku, and Bcrypt</a>
      </li>
    
      <li class="post">
        <a href="/2016/06/27/back-to-basics-editors/">Back to Basics - Editors</a>
      </li>
    
      <li class="post">
        <a href="/2016/06/23/reading-not-reading/">Reading Not Reading</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/rickerbh">@rickerbh</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rickerbh',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rickerbh", , );
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <p>Follow <a href="http://twitter.com/rickerbh">@rickerbh</a></p>
  
</section>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/103674783197570316138?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Hamish Rickerby -
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'itickedthewrongbox';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://hamishrickerby.com/2016/07/05/a-small-functional-refactoring-of-some-javascript/';
        var disqus_url = 'https://hamishrickerby.com/2016/07/05/a-small-functional-refactoring-of-some-javascript/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
